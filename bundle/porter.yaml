schemaType: Bundle
schemaVersion: 1.0.1
name: back-stack
version: 0.1.0
description: "The BACK stack showcase bundle"

dockerfile: template.Dockerfile
registry: "localhost:5000"

credentials:
  # required
  - name: github-token
    env: GITHUB_TOKEN
    applyTo:
      - install
  - name: vault-token
    env: VAULT_TOKEN
    applyTo:
      - install
  - name: azure-credentials
    env: AZURE_CREDENTIALS
    applyTo:
      - install
  - name: aws-credentials
    env: AWS_CREDENTIALS
    applyTo:
      - install
  # optional
  - name: kubeconfig
    path: /home/nonroot/.kube/config
    required: false
    applyTo:
      - install

parameters:
  - name: use-kind
    env: USE_KIND
    type: boolean
    default: true
  - name: repository
    env: REPOSITORY
    type: string
    default: https://github.com/back-stack/showcase
  - name: backstage-host
    env: BACKSTAGE_HOST
    type: string
    default: backstage-7f000001.nip.io
  - name: argocd-host
    env: ARGOCD_HOST
    type: string
    default: argocd-7f000001.nip.io
  - name: vault-host
    env: VAULT_HOST
    type: string
    default: vault-7f000001.nip.io

outputs:
  - name: kubeconfig
    type: file
    path: /home/nonroot/.kube/config
    applyTo:
      - install

mixins:
  - exec
  - docker
  - kubernetes
  - helm3:
      clientVersion: v3.13.2
      repositories:
        crossplane-stable:
          url: https://charts.crossplane.io/stable
        ingress-nginx:
          url: https://kubernetes.github.io/ingress-nginx

# Define the steps that should execute when the bundle is installed
install:
  - exec:
      description: "Ensure Kubernetes Connection"
      command: ./helpers.sh
      arguments:
        - install

# Define the steps that should execute when the bundle is upgraded
upgrade:
  - exec:
      description: "World 2.0"
      command: ./helpers.sh
      arguments:
        - upgrade

# Define the steps that should execute when the bundle is uninstalled
uninstall:
  - exec:
      description: "Uninstall Hello World"
      command: ./helpers.sh
      arguments:
        - uninstall